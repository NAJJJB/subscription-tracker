<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Subscription Tracker</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div class="dashboard-container">
    <div class="header">
      <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
        <div>
          <h1 class="logo">Welcome, <%= user.name %>!</h1>
          <p class="subtitle">Manage your subscriptions</p>
        </div>
        <a href="/logout" style="background: #6b7280; color: white; text-decoration: none; padding: 0.5rem 1rem; border-radius: 6px; font-size: 0.875rem; transition: background 0.2s;" onmouseover="this.style.background='#4b5563'" onmouseout="this.style.background='#6b7280'">Logout</a>
      </div>
    </div>
    
    <form method="POST" action="/add">
      <div class="form-group">
        <input name="name" placeholder="Subscription name (e.g., Netflix, Spotify)" required />
        <input name="price" type="number" step="0.01" placeholder="Monthly price ($)" required />
        <input name="renewsAt" type="date" placeholder="Renewal date" required />
        <select name="notifyDays" required>
          <option value="">When to notify</option>
          <option value="1">1 day before</option>
          <option value="3">3 days before</option>
          <option value="7">1 week before</option>
          <option value="14">2 weeks before</option>
          <option value="30">1 month before</option>
        </select>
        <button type="submit" style="font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">Add Subscription</button>
      </div>
    </form>
    
    <!-- Discord Webhook Configuration -->
    <div style="margin-bottom: 2rem; padding: 1rem; background: #f8fafc; border-radius: 8px; border-left: 4px solid #5865F2;">
      <h3 style="margin: 0 0 1rem 0; color: #374151; font-size: 1rem;">ðŸ”” Discord Notifications</h3>
      <form method="POST" action="/webhook" style="display: flex; gap: 1rem; align-items: center;">
        <input 
          name="webhookUrl" 
          type="url" 
          placeholder="Discord Webhook URL (optional)" 
          value="<%= webhookUrl || '' %>"
          style="flex: 1; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem;"
        />
        <button type="submit" style="background: #5865F2; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 0.875rem; cursor: pointer;">
          Save Webhook
        </button>
      </form>
      <p style="margin: 0.5rem 0 0 0; color: #6b7280; font-size: 0.75rem;">
        Add a Discord webhook URL to receive renewal notifications. 
        <a href="https://support.discord.com/hc/en-us/articles/228383668-Intro-to-Webhooks" target="_blank" style="color: #5865F2;">Learn how to create webhooks</a>
      </p>
    </div>
    
    <div class="subscriptions-list">
      <% if (subscriptions.length > 0) { %>
        <h3 style="margin-bottom: 1rem; color: #374151;">Your Subscriptions</h3>
        <div style="display: grid; gap: 1rem;">
          <% subscriptions.forEach(sub => { %>
            <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1rem; background: white;">
              <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                <div>
                  <h4 style="margin: 0; color: #374151; font-size: 1.125rem;"><%= sub.name %></h4>
                  <p style="margin: 0.25rem 0; color: #059669; font-weight: 600;">$<%= sub.price %>/month</p>
                </div>
                <form method="POST" action="/remove" style="margin: 0;">
                  <input type="hidden" name="name" value="<%= sub.name %>" />
                  <button type="submit" style="font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #ef4444; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 4px; cursor: pointer; font-size: 0.875rem;" onclick="return confirm('Are you sure you want to remove this subscription?')">Remove</button>
                </form>
              </div>
              <% if (sub.renewsAt) { %>
                <p style="margin: 0.25rem 0; color: #6b7280; font-size: 0.875rem;">
                  <strong>Renews:</strong> <%= new Date(sub.renewsAt).toLocaleDateString() %>
                </p>
              <% } %>
              <% if (sub.notifyDays) { %>
                <p style="margin: 0.25rem 0; color: #6b7280; font-size: 0.875rem;">
                  <strong>Notify:</strong> <%= sub.notifyDays %> day<%= sub.notifyDays > 1 ? 's' : '' %> before renewal
                </p>
              <% } %>
            </div>
          <% }) %>
        </div>
        <div style="margin-top: 1.5rem; padding: 1rem; background: #f3f4f6; border-radius: 8px;">
          <strong>Total Monthly Cost: $<%= subscriptions.reduce((total, sub) => total + parseFloat(sub.price), 0).toFixed(2) %></strong>
        </div>
      <% } else { %>
        <div style="text-align: center; padding: 2rem; color: #6b7280;">
          <p>No subscriptions yet. Add your first subscription above!</p>
        </div>
      <% } %>
    </div>
  </div>
</body>
</html>
